module.exports=[95398,e=>{"use strict";var t=e.i(40460),r=e.i(64747),s=e.i(39250),n=e.i(19326),o=e.i(43547),a=e.i(94922),i=e.i(11985),u=e.i(50529),d=e.i(8187),l=e.i(89920),c=e.i(69543),p=e.i(19469),E=e.i(71884),R=e.i(92572),f=e.i(2657),_=e.i(939),D=e.i(93695);e.i(12859);var I=e.i(38928),h=e.i(67442),x=e.i(68105),O=e.i(62294),N=e.i(15428);async function v(e){try{let t=await x.auth.api.getSession({headers:e.headers});if(!t?.session?.userId)return h.NextResponse.json({error:"Unauthorized"},{status:401});let[r]=await O.default.execute("SELECT accountId FROM account WHERE userId = ? AND providerId = 'discord' LIMIT 1",[t.session.userId]),s=Array.isArray(r)?r[0]:null,n=s?.accountId;if(!n)return h.NextResponse.json({error:"No Discord account linked"},{status:404});let o=process.env.DISCORD_GUILD_ID,a=process.env.DISCORD_BOT_TOKEN,i=process.env.DISCORD_VEDENI_ROLE_ID,u=process.env.DISCORD_STAFF_ROLE_ID,d=process.env.DISCORD_DEVELOPER_ROLE_ID;try{let e=(await N.default.get(`https://discord.com/api/v10/guilds/${o}/members/${n}`,{headers:{Authorization:`Bot ${a}`}})).data.roles||[];if(!(e.includes(i)||e.includes(u)||e.includes(d)))return h.NextResponse.json({error:"Admin permissions required"},{status:403})}catch(e){return console.error("Error fetching Discord roles:",e),h.NextResponse.json({error:"Error verifying permissions"},{status:500})}let[l]=await O.default.execute(`
            SELECT * FROM rule_sections 
            ORDER BY order_index ASC
        `),[c]=await O.default.execute(`
            SELECT * FROM rules 
            ORDER BY section_id ASC, order_index ASC
        `),[p]=await O.default.execute(`
            SELECT * FROM rule_subcategories 
            ORDER BY section_id ASC, order_index ASC
        `);return h.NextResponse.json({sections:l,rules:c,subcategories:p})}catch(e){return console.error("Error fetching rules:",e),h.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e){try{let t=await x.auth.api.getSession({headers:e.headers});if(!t?.session?.userId)return h.NextResponse.json({error:"Unauthorized"},{status:401});let[r]=await O.default.execute("SELECT accountId FROM account WHERE userId = ? AND providerId = 'discord' LIMIT 1",[t.session.userId]),s=Array.isArray(r)?r[0]:null,n=s?.accountId;if(!n)return h.NextResponse.json({error:"No Discord account linked"},{status:404});let o=process.env.DISCORD_GUILD_ID,a=process.env.DISCORD_BOT_TOKEN,i=process.env.DISCORD_VEDENI_ROLE_ID,u=process.env.DISCORD_STAFF_ROLE_ID,d=process.env.DISCORD_DEVELOPER_ROLE_ID;try{let e=(await N.default.get(`https://discord.com/api/v10/guilds/${o}/members/${n}`,{headers:{Authorization:`Bot ${a}`}})).data.roles||[];if(!(e.includes(i)||e.includes(u)||e.includes(d)))return h.NextResponse.json({error:"Admin permissions required"},{status:403})}catch(e){return console.error("Error fetching Discord roles:",e),h.NextResponse.json({error:"Error verifying permissions"},{status:500})}let{type:l,data:c}=await e.json();if("section"===l){let{id:e,title:t,icon:r,order_index:s}=c;if(!e||!t)return h.NextResponse.json({error:"Missing required fields for section"},{status:400});return await O.default.execute(`
                INSERT INTO rule_sections (id, title, icon, order_index, created_at, updated_at) 
                VALUES (?, ?, ?, ?, NOW(), NOW())
                ON DUPLICATE KEY UPDATE 
                title = VALUES(title), 
                icon = VALUES(icon), 
                order_index = VALUES(order_index),
                updated_at = NOW()
            `,[e,t,r||null,s||0]),h.NextResponse.json({message:"Section saved successfully"})}if("rule"===l){let{id:e,section_id:t,subcategory_id:r,content:s,order_index:n}=c;if(!t||!s)return h.NextResponse.json({error:"Missing required fields for rule"},{status:400});if(e)return await O.default.execute(`
                    UPDATE rules 
                    SET section_id = ?, subcategory_id = ?, content = ?, order_index = ?, updated_at = NOW()
                    WHERE id = ?
                `,[t,r||null,s,n||0,e]),h.NextResponse.json({message:"Rule updated successfully"});{let[e]=await O.default.execute(`
                    INSERT INTO rules (section_id, subcategory_id, content, order_index, created_at, updated_at) 
                    VALUES (?, ?, ?, ?, NOW(), NOW())
                `,[t,r||null,s,n||0]);return h.NextResponse.json({message:"Rule created successfully",id:e.insertId})}}{if("subcategory"!==l)return h.NextResponse.json({error:"Invalid type"},{status:400});let{section_id:e,id:t,title:r,icon:s,order_index:n}=c;if(!e||!t||!r)return h.NextResponse.json({error:"Missing required fields for subcategory"},{status:400});return await O.default.execute(`
                INSERT INTO rule_subcategories (section_id, id, title, icon, order_index, created_at, updated_at) 
                VALUES (?, ?, ?, ?, ?, NOW(), NOW())
                ON DUPLICATE KEY UPDATE 
                title = VALUES(title), 
                icon = VALUES(icon), 
                order_index = VALUES(order_index),
                updated_at = NOW()
            `,[e,t,r,s||null,n||0]),h.NextResponse.json({message:"Subcategory saved successfully"})}}catch(e){return console.error("Error creating rule:",e),h.NextResponse.json({error:"Internal server error"},{status:500})}}async function S(e){try{let t=await x.auth.api.getSession({headers:e.headers});if(!t?.session?.userId)return h.NextResponse.json({error:"Unauthorized"},{status:401});let[r]=await O.default.execute("SELECT accountId FROM account WHERE userId = ? AND providerId = 'discord' LIMIT 1",[t.session.userId]),s=Array.isArray(r)?r[0]:null,n=s?.accountId;if(!n)return h.NextResponse.json({error:"No Discord account linked"},{status:404});let o=process.env.DISCORD_GUILD_ID,a=process.env.DISCORD_BOT_TOKEN,i=process.env.DISCORD_VEDENI_ROLE_ID,u=process.env.DISCORD_STAFF_ROLE_ID,d=process.env.DISCORD_DEVELOPER_ROLE_ID;try{let e=(await N.default.get(`https://discord.com/api/v10/guilds/${o}/members/${n}`,{headers:{Authorization:`Bot ${a}`}})).data.roles||[];if(!(e.includes(i)||e.includes(u)||e.includes(d)))return h.NextResponse.json({error:"Admin permissions required"},{status:403})}catch(e){return console.error("Error fetching Discord roles:",e),h.NextResponse.json({error:"Error verifying permissions"},{status:500})}let{type:l,items:c}=await e.json();if(!l||!Array.isArray(c))return h.NextResponse.json({error:"Invalid payload"},{status:400});let p={rules:"rules",sections:"rule_sections",subcategories:"rule_subcategories"}[l];if(!p)return h.NextResponse.json({error:"Invalid type specified"},{status:400});let E=await O.default.getConnection();try{for(let e of(await E.beginTransaction(),c)){if(void 0===e.id||"number"!=typeof e.order_index)throw Error("Invalid item structure in payload");await E.execute(`UPDATE \`${p}\` SET order_index = ? WHERE id = ?`,[e.order_index,e.id])}return await E.commit(),h.NextResponse.json({message:"Order updated successfully"})}catch(e){return await E.rollback(),console.error("Error updating order:",e),h.NextResponse.json({error:"Failed to update order"},{status:500})}finally{E.release()}}catch(e){return console.error("Error in PATCH route:",e),h.NextResponse.json({error:"Internal server error"},{status:500})}}async function y(e){try{let t=await x.auth.api.getSession({headers:e.headers});if(!t?.session?.userId)return h.NextResponse.json({error:"Unauthorized"},{status:401});let[r]=await O.default.execute("SELECT accountId FROM account WHERE userId = ? AND providerId = 'discord' LIMIT 1",[t.session.userId]),s=Array.isArray(r)?r[0]:null,n=s?.accountId;if(!n)return h.NextResponse.json({error:"No Discord account linked"},{status:404});let o=process.env.DISCORD_GUILD_ID,a=process.env.DISCORD_BOT_TOKEN,i=process.env.DISCORD_VEDENI_ROLE_ID,u=process.env.DISCORD_STAFF_ROLE_ID,d=process.env.DISCORD_DEVELOPER_ROLE_ID;try{let e=(await N.default.get(`https://discord.com/api/v10/guilds/${o}/members/${n}`,{headers:{Authorization:`Bot ${a}`}})).data.roles||[];if(!(e.includes(i)||e.includes(u)||e.includes(d)))return h.NextResponse.json({error:"Admin permissions required"},{status:403})}catch(e){return console.error("Error fetching Discord roles:",e),h.NextResponse.json({error:"Error verifying permissions"},{status:500})}let{type:l,id:c}=await e.json();if(!l||!c)return h.NextResponse.json({error:"Missing type or id"},{status:400});if("section"===l)return await O.default.execute("DELETE FROM rule_sections WHERE id = ?",[c]),await O.default.execute("DELETE FROM rule_subcategories WHERE section_id = ?",[c]),await O.default.execute("DELETE FROM rules WHERE section_id = ?",[c]),h.NextResponse.json({message:"Section and its contents deleted successfully"});if("rule"===l)return await O.default.execute("DELETE FROM rules WHERE id = ?",[c]),h.NextResponse.json({message:"Rule deleted successfully"});if("subcategory"===l)return await O.default.execute("DELETE FROM rule_subcategories WHERE id = ?",[c]),await O.default.execute("DELETE FROM rules WHERE subcategory_id = ?",[c]),h.NextResponse.json({message:"Subcategory and its rules deleted successfully"});else return h.NextResponse.json({error:"Invalid type"},{status:400})}catch(e){return console.error("Error deleting item:",e),h.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["DELETE",()=>y,"GET",()=>v,"PATCH",()=>S,"POST",()=>g],92131);var A=e.i(92131);let m=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/rules/route",pathname:"/api/admin/rules",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/admin/rules/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:T,workUnitAsyncStorage:C,serverHooks:w}=m;function L(){return(0,s.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:C})}async function j(e,t,s){m.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let h="/api/admin/rules/route";h=h.replace(/\/index$/,"")||"/";let x=await m.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:O,params:N,nextConfig:v,parsedUrl:g,isDraftMode:S,prerenderManifest:y,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,resolvedPathname:w,clientReferenceManifest:L,serverActionsManifest:j}=x,b=(0,u.normalizeAppPath)(h),U=!!(y.dynamicRoutes[b]||y.routes[w]),M=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,g,!1):t.end("This page could not be found"),null);if(U&&!S){let e=!!y.routes[w],t=y.dynamicRoutes[b];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await M();throw new D.NoFallbackError}}let P=null;!U||m.isDev||S||(P="/index"===(P=w)?"/":P);let H=!0===m.isDev||!U,F=U&&!H;j&&L&&(0,a.setReferenceManifestsSingleton)({page:h,clientReferenceManifest:L,serverActionsManifest:j,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:j})});let W=e.method||"GET",$=(0,o.getTracer)(),q=$.getActiveScopeSpan(),V={params:N,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>m.onRequestError(e,t,s,A)},sharedContext:{buildId:O}},k=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),K=l.NextRequestAdapter.fromNodeNextRequest(k,(0,l.signalFromNodeResponse)(t));try{let a=async e=>m.handle(K,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${W} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${W} ${h}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var o,u;let d=async({previousCacheEntry:r})=>{try{if(!i&&T&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await a(n);e.fetchMetrics=V.renderOpts.fetchMetrics;let u=V.renderOpts.pendingWaitUntil;u&&s.waitUntil&&(s.waitUntil(u),u=void 0);let d=V.renderOpts.collectedTags;if(!U)return await (0,E.sendResponse)(k,B,o,V.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[_.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,s=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:I.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await m.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:T})},A),t}},l=await m.handleResponse({req:e,nextConfig:v,cacheKey:P,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:s.waitUntil,isMinimalMode:i});if(!U)return null;if((null==l||null==(o=l.value)?void 0:o.kind)!==I.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,R.fromNodeOutgoingHttpHeaders)(l.value.headers);return i&&U||c.delete(_.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(l.cacheControl)),await (0,E.sendResponse)(k,B,new Response(l.value.body,{headers:c,status:l.value.status||200})),null};q?await u(q):await $.withPropagatedContext(e.headers,()=>$.trace(c.BaseServerSpan.handleRequest,{spanName:`${W} ${h}`,kind:o.SpanKind.SERVER,attributes:{"http.method":W,"http.target":e.url}},u))}catch(t){if(t instanceof D.NoFallbackError||await m.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:T})}),U)throw t;return await (0,E.sendResponse)(k,B,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>L,"routeModule",()=>m,"serverHooks",()=>w,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>C],95398)}];

//# sourceMappingURL=edc2e_next_dist_esm_build_templates_app-route_20d0f8d4.js.map