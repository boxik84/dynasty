module.exports=[8337,a=>{"use strict";var b=a.i(2470),c=a.i(76972),d=a.i(39039),e=a.i(90100),f=a.i(18195),g=a.i(68454),h=a.i(40695),i=a.i(5522),j=a.i(17171),k=a.i(46893),l=a.i(87682),m=a.i(63243),n=a.i(86140),o=a.i(32636),p=a.i(53966),q=a.i(494),r=a.i(15884),s=a.i(90063),t=a.i(80833),u=a.i(56916),v=a.i(5094);function w(a){let{attributes:c,listeners:d,setNodeRef:g,transform:h,transition:i}=(0,e.useSortable)({id:a.item.id,data:{type:a.type,item:a.item}}),j={transform:f.CSS.Transform.toString(h),transition:i};return(0,b.jsxs)("div",{ref:g,style:j,className:"flex items-center gap-2 w-full",children:[(0,b.jsx)("button",{...c,...d,className:"p-2 text-gray-400 hover:text-white transition-colors cursor-grab active:cursor-grabbing",children:(0,b.jsx)(r.GripVertical,{className:"h-5 w-5"})}),(0,b.jsx)("div",{className:"flex-1",children:a.children})]})}function x(){let[a,f]=(0,c.useState)({sections:[],subcategories:[],rules:[]}),[r,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)("rule"),[C,D]=(0,c.useState)({}),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)({}),M=(0,d.useSensors)((0,d.useSensor)(d.PointerSensor),(0,d.useSensor)(d.KeyboardSensor,{coordinateGetter:e.sortableKeyboardCoordinates}));(0,c.useEffect)(()=>{N()},[]);let N=async()=>{try{x(!0);let a=await fetch("/api/admin/rules");if(!a.ok)return void u.toast.error("Chyba při načítání pravidel");let b=await a.json();f({sections:b.sections.sort((a,b)=>a.order_index-b.order_index),subcategories:b.subcategories.sort((a,b)=>a.order_index-b.order_index),rules:b.rules.sort((a,b)=>a.order_index-b.order_index)})}catch(a){console.error("Error fetching rules:",a),u.toast.error("Chyba při načítání pravidel")}finally{x(!1)}},O=async b=>{let c,{active:d,over:g}=b;if(!g||d.id===g.id)return;let h=d.data.current?.type,i=d.data.current?.item,j=g.data.current?.type;if(!h||!i||h!==j)return;let k={section:"sections",subcategory:"subcategories",rule:"rules"}[h],l=a[k],m=(c="section"===h?[...a.sections]:"subcategory"===h?a.subcategories.filter(a=>a.section_id===i.section_id):a.rules.filter(a=>a.section_id===i.section_id&&a.subcategory_id===i.subcategory_id)).findIndex(a=>a.id===d.id),n=c.findIndex(a=>a.id===g.id);if(-1===m||-1===n)return;let o=(0,e.arrayMove)(c,m,n),p=o.map((a,b)=>({id:a.id,order_index:b})),q=o.map((a,b)=>({...a,order_index:b})),r=l.map(a=>q.find(b=>b.id===a.id)||a);"sections"===k?r.sort((a,b)=>a.order_index-b.order_index):"subcategories"===k?r.sort((a,b)=>a.section_id<b.section_id?-1:a.section_id>b.section_id?1:a.order_index-b.order_index):"rules"===k&&r.sort((a,b)=>{if(a.section_id<b.section_id)return -1;if(a.section_id>b.section_id)return 1;let c=a.subcategory_id||"",d=b.subcategory_id||"";return c<d?-1:c>d?1:a.order_index-b.order_index}),f(a=>({...a,[k]:r}));try{(await fetch("/api/admin/rules",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:k,items:p})})).ok?u.toast.success("Pořadí bylo úspěšně uloženo."):(u.toast.error("Nepodařilo se uložit nové pořadí."),N())}catch(a){u.toast.error("Chyba sítě při ukládání pořadí."),N()}},P=(a,b)=>{B(a),D(b),z(!0)},Q=(b,c={})=>{B(b),D("section"===b?{id:"",title:"",icon:"",order_index:a.sections.length}:"subcategory"===b?{id:"",section_id:c.section_id,title:"",icon:"",order_index:a.subcategories.filter(a=>a.section_id===c.section_id).length}:{section_id:c.section_id,subcategory_id:c.subcategory_id||null,content:"",order_index:a.rules.filter(a=>a.section_id===c.section_id&&a.subcategory_id===(c.subcategory_id||null)).length}),z(!0)},R=async()=>{try{F(!0);let a=await fetch("/api/admin/rules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:A,data:C})});if(!a.ok){let b=await a.json();u.toast.error(b.error||"Chyba při ukládání");return}u.toast.success("Položka byla úspěšně uložena!"),z(!1),N()}catch(a){console.error("Error saving:",a),u.toast.error("Chyba při ukládání")}finally{F(!1)}},S=async()=>{if(I)try{H(!0);let a=await fetch("/api/admin/rules",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(!a.ok){let b=await a.json();u.toast.error(b.error||"Chyba při mazání");return}u.toast.success("Položka byla úspěšně smazána!"),J(null),N()}catch(a){console.error("Error deleting:",a),u.toast.error("Chyba při mazání")}finally{H(!1)}},T=a=>{L(b=>({...b,[a]:!b[a]}))};if(r)return(0,b.jsx)("div",{className:"p-8",children:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-96",children:(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin"})})});let U=a=>(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4 p-3 rounded-lg bg-zinc-800/50 border border-zinc-700/50 group w-full",children:[(0,b.jsx)("p",{className:"text-sm text-zinc-300 flex-1 break-words",children:a.content}),(0,b.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>P("rule",a),className:"h-8 w-8 hover:bg-blue-500/20 hover:text-blue-400",children:(0,b.jsx)(n.Edit3,{className:"h-4 w-4"})}),(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>J({type:"rule",id:a.id}),className:"h-8 w-8 hover:bg-red-500/20 hover:text-red-400",children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4"})})]})]});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8",children:[(0,b.jsxs)("header",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Správa Pravidel"}),(0,b.jsx)("p",{className:"text-zinc-400 mt-1",children:"Uspořádejte, upravujte a přidávejte pravidla serveru."})]}),(0,b.jsxs)(h.Button,{onClick:()=>Q("section"),className:"bg-red-600 hover:bg-red-700 text-white",children:[(0,b.jsx)(m.Plus,{className:"mr-2 h-4 w-4"}),"Přidat novou sekci"]})]}),(0,b.jsx)("main",{className:"flex flex-col gap-6",children:(0,b.jsx)(d.DndContext,{sensors:M,collisionDetection:d.closestCenter,onDragEnd:O,modifiers:[g.restrictToVerticalAxis,g.restrictToWindowEdges],children:(0,b.jsx)(e.SortableContext,{items:a.sections.map(a=>a.id),strategy:e.verticalListSortingStrategy,children:a.sections.map(c=>{let f,i;return(0,b.jsx)(w,{type:"section",item:c,children:(f=a.subcategories.filter(a=>a.section_id===c.id),i=a.rules.filter(a=>a.section_id===c.id&&!a.subcategory_id),(0,b.jsxs)("div",{className:"p-4 rounded-xl bg-zinc-900 border border-zinc-700/80 w-full",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>T(c.id),className:"p-1 hover:bg-zinc-800 rounded-md",children:(0,b.jsx)(s.ChevronDown,{className:`h-6 w-6 transition-transform ${K[c.id]?"rotate-180":""}`})}),(0,b.jsx)("h2",{className:"font-bold text-xl text-white",children:c.title}),(0,b.jsx)("span",{className:"text-xs font-mono px-2 py-1 bg-zinc-700 rounded-md",children:i.length+a.rules.filter(a=>f.some(b=>b.id===a.subcategory_id)).length})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(h.Button,{size:"sm",onClick:()=>Q("subcategory",{section_id:c.id}),children:"Přidat podkategorii"}),(0,b.jsx)(h.Button,{size:"sm",variant:"ghost",onClick:()=>Q("rule",{section_id:c.id}),children:"Přidat pravidlo"}),(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>P("section",c),className:"h-8 w-8 hover:bg-blue-500/20 hover:text-blue-400",children:(0,b.jsx)(n.Edit3,{className:"h-4 w-4"})}),(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>J({type:"section",id:c.id}),className:"h-8 w-8 hover:bg-red-500/20 hover:text-red-400",children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4"})})]})]}),K[c.id]&&(0,b.jsxs)("div",{className:"pl-8 pt-4 border-l-2 border-zinc-700 ml-4 flex flex-col gap-4",children:[(0,b.jsx)(d.DndContext,{sensors:M,collisionDetection:d.closestCenter,onDragEnd:O,modifiers:[g.restrictToVerticalAxis,g.restrictToWindowEdges],children:(0,b.jsx)(e.SortableContext,{items:f.map(a=>a.id),strategy:e.verticalListSortingStrategy,children:f.map(c=>{let f;return(0,b.jsx)(w,{type:"subcategory",item:c,children:(f=a.rules.filter(a=>a.subcategory_id===c.id),(0,b.jsxs)("div",{className:"p-4 rounded-lg bg-zinc-800 border border-zinc-700 w-full",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>T(c.id),className:"p-1 hover:bg-zinc-700 rounded-md",children:(0,b.jsx)(s.ChevronDown,{className:`h-5 w-5 transition-transform ${K[c.id]?"rotate-180":""}`})}),(0,b.jsx)("h3",{className:"font-semibold text-lg text-zinc-100",children:c.title}),(0,b.jsx)("span",{className:"text-xs font-mono px-2 py-1 bg-zinc-700 rounded-md",children:f.length})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(h.Button,{size:"sm",variant:"ghost",onClick:()=>Q("rule",{section_id:c.section_id,subcategory_id:c.id}),children:"Přidat pravidlo"}),(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>P("subcategory",c),className:"h-8 w-8 hover:bg-blue-500/20 hover:text-blue-400",children:(0,b.jsx)(n.Edit3,{className:"h-4 w-4"})}),(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>J({type:"subcategory",id:c.id}),className:"h-8 w-8 hover:bg-red-500/20 hover:text-red-400",children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4"})})]})]}),K[c.id]&&(0,b.jsxs)("div",{className:"pl-8 pt-3 border-l-2 border-zinc-700 ml-3 flex flex-col gap-3",children:[(0,b.jsx)(d.DndContext,{sensors:M,collisionDetection:d.closestCenter,onDragEnd:O,modifiers:[g.restrictToVerticalAxis,g.restrictToWindowEdges],children:(0,b.jsx)(e.SortableContext,{items:f.map(a=>a.id),strategy:e.verticalListSortingStrategy,children:f.map(a=>(0,b.jsx)(w,{type:"rule",item:a,children:U(a)},a.id))})}),0===f.length&&(0,b.jsx)("p",{className:"text-zinc-400 text-sm",children:"Žádná pravidla v této podkategorii."})]})]}))},c.id)})})}),(0,b.jsx)(d.DndContext,{sensors:M,collisionDetection:d.closestCenter,onDragEnd:O,modifiers:[g.restrictToVerticalAxis,g.restrictToWindowEdges],children:(0,b.jsx)(e.SortableContext,{items:i.map(a=>a.id),strategy:e.verticalListSortingStrategy,children:i.map(a=>(0,b.jsx)(w,{type:"rule",item:a,children:U(a)},a.id))})}),0===f.length&&0===i.length&&(0,b.jsx)("p",{className:"text-zinc-400 text-sm",children:"Žádný obsah v této sekci."})]})]},c.id))},c.id)})})})})]}),y&&(0,b.jsx)(t.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 flex justify-center items-center",onClick:()=>z(!1),children:(0,b.jsxs)(t.motion.div,{initial:{scale:.95,y:20},animate:{scale:1,y:0},exit:{scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"bg-zinc-900 border border-zinc-700 rounded-2xl shadow-2xl w-full max-w-2xl p-8",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold text-white",children:[C.id&&""!==C.id?"Upravit":"Vytvořit"," ","section"===A?"sekci":"subcategory"===A?"podkategorii":"pravidlo"]}),(0,b.jsx)(h.Button,{size:"icon",variant:"ghost",onClick:()=>z(!1),className:"h-8 w-8 hover:bg-zinc-700",children:(0,b.jsx)(q.X,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[("section"===A||"subcategory"===A)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"title",children:"Název"}),(0,b.jsx)(i.Input,{id:"title",value:C.title||"",onChange:a=>D({...C,title:a.target.value}),className:"mt-1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(j.Label,{htmlFor:"id",children:["Unikátní ID (bez diakritiky, např. ",'"obecna_pravidla',")"]}),(0,b.jsx)(i.Input,{id:"id",value:C.id||"",onChange:a=>D({...C,id:a.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")}),className:"mt-1 font-mono",disabled:!!C.id&&""!==C.id})]})]}),"rule"===A&&(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"content",children:"Obsah pravidla"}),(0,b.jsx)(k.Textarea,{id:"content",value:C.content||"",onChange:a=>D({...C,content:a.target.value}),className:"mt-1",rows:5}),(0,b.jsxs)("p",{className:"text-xs text-zinc-400 mt-2",children:["Můžete použít Markdown pro formátování. Např: ",(0,b.jsx)("code",{className:"text-xs",children:"**tučně**"}),", ",(0,b.jsx)("code",{className:"text-xs",children:"*kurzíva*"}),", ",(0,b.jsx)("code",{className:"text-xs",children:"`kód`"}),"."]})]}),"rule"===A&&(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"section_id",children:"Sekce"}),(0,b.jsxs)(l.Select,{value:C.section_id,onValueChange:a=>D({...C,section_id:a,subcategory_id:null}),children:[(0,b.jsx)(l.SelectTrigger,{id:"section_id",className:"mt-1",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsx)(l.SelectContent,{children:a.sections.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.title},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"subcategory_id",children:"Podkategorie (volitelné)"}),(0,b.jsxs)(l.Select,{value:C.subcategory_id||"none",onValueChange:a=>D({...C,subcategory_id:"none"===a?null:a}),disabled:!C.section_id,children:[(0,b.jsx)(l.SelectTrigger,{id:"subcategory_id",className:"mt-1",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"none",children:"Žádná podkategorie"}),a.subcategories.filter(a=>a.section_id===C.section_id).map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.title},a.id))]})]})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-zinc-700",children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:()=>z(!1),children:"Zrušit"}),(0,b.jsx)(h.Button,{onClick:R,disabled:E,className:"bg-red-600 hover:bg-red-700 text-white",children:E?"Ukládání...":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Save,{className:"mr-2 h-4 w-4"})," Uložit"]})})]})]})}),(0,b.jsx)(v.AlertDialog,{open:!!I,onOpenChange:()=>J(null),children:(0,b.jsxs)(v.AlertDialogContent,{children:[(0,b.jsxs)(v.AlertDialogHeader,{children:[(0,b.jsx)(v.AlertDialogTitle,{children:"Opravdu chcete smazat tuto položku?"}),(0,b.jsx)(v.AlertDialogDescription,{children:"Tato akce je nevratná. Pokud smažete sekci nebo podkategorii, smažou se i VŠECHNA pravidla v ní obsažená."})]}),(0,b.jsxs)(v.AlertDialogFooter,{children:[(0,b.jsx)(v.AlertDialogCancel,{children:"Zrušit"}),(0,b.jsx)(v.AlertDialogAction,{onClick:S,disabled:G,className:(0,h.buttonVariants)({variant:"destructive"}),children:G?"Mazání...":"Smazat"})]})]})})]})}a.s(["default",()=>x])}];

//# sourceMappingURL=app_admin_rules_page_tsx_011a4a4b._.js.map